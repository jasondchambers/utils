#!/usr/bin/env sh

session_exists() {
  tmux has-session -t="$1" 2>/dev/null
}

main() {
  selected_repo=$(ls -1 ~/repos | fzf)

  if [ -z "$selected_repo" ]; then
    echo "No repository selected."
    exit 0
  fi

  echo "Selected repository: $selected_repo"

  if session_exists "$selected_repo"; then
    echo "Session '$selected_repo' already exists."
    if [ -n "$TMUX" ]; then
      echo "Switching to session."
      tmux switch-client -t "$selected_repo"
    else
      echo "Attaching to session."
      tmux attach-session -t "$selected_repo"
    fi
  else
    echo "Creating new session: $selected_repo"
    cd ~/repos/${selected_repo}
    if [ -n "$TMUX" ]; then
      tmux new-session -d -s "$selected_repo"
      tmux switch-client -t "$selected_repo"
    else
      tmux new-session -s "$selected_repo"
    fi
  fi
}

main
